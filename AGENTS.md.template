## üåä TIDE WATCH: Context Window Monitoring

**Proactive capacity management to prevent session lockups.**

**Monitoring schedule:** (customize or use default)
- Check frequency: **Every 1 hour** (options: 15min, 30min, 1hr, 2hr, or 'manual')
- Also check during **intensive project work** (reading many files, generating long outputs)
- Also check when I notice **unusually long conversations** accumulating

**Warning thresholds:** (customize or use defaults)
- **75%** (150k/200k): üü° "Heads up: Context at 75%. Consider wrapping up or switching channels soon."
- **85%** (170k/200k): üü† "Context at 85%. Recommend finishing current task and resetting session."
- **90%** (180k/200k): üî¥ "Context at 90%! Session will lock at 100%. Ready to help you reset?"
- **95%** (190k/200k): üö® "CRITICAL: Context at 95%! Save important info to memory NOW and reset."

**Auto-backup:** (customize or disable)
- Enabled: true  # Set false to disable all automatic backups
- Trigger at thresholds: [90, 95]  # Subset of warning thresholds
- Retention: 7 days
- Compress: false  # Set true to save disk space

To disable automatic backups entirely, set:
- Enabled: false

**Actions to suggest:**
1. **Memory save**: Offer to save current context/decisions to `memory/YYYY-MM-DD.md` or project work logs
2. **Channel switch**: Suggest moving to lower-usage session (webchat, DM, etc.)
3. **Session reset**: Provide reset command and context-restoration prompt
4. **File reference**: For project work, remind that docs persist in files

**Implementation:**
- Silent check (don't spam with status unless approaching threshold)
- Only warn once per threshold (track internally during session)
- At 90%+, be insistent but helpful
- Never let session hit 100% without warning

**Why this matters:** Proactive monitoring prevents lost work and frustration when sessions lock at capacity.

---

## üìã SESSION RESTORATION PROMPTS

**On session start or after reset:**

1. **Check for restoration prompt:**
   - Path: `~/.openclaw/agents/main/sessions/restore-prompts/<session-id>.md`
   - Alternative: `~/.openclaw/agents/main/sessions/restore-prompts/default.md`

2. **If restoration prompt exists:**
   - Check if enabled (no `.disabled` marker file)
   - Read the file contents
   - Apply the context from the prompt
   - Acknowledge restoration briefly: "‚úÖ Session restored from restoration prompt. Ready to continue [project]!"

3. **If no restoration prompt exists:**
   - Continue with normal session start (no error message)
   - Optionally suggest creating one (see feature discovery below)

**How to detect session start/reset:**
- First message of the session
- Token usage is very low (< 5,000 tokens)
- Session context is minimal/empty

**Restoration prompt location:**
`~/.openclaw/agents/main/sessions/restore-prompts/<session-id>.md`

**Check if enabled:**
- Enabled by default if prompt file exists
- Disabled if `.disabled` marker file exists: `<session-id>.md.disabled`

**Manual trigger (fallback):**

User can explicitly request restoration at any time (not just on reset):

**Recognize these triggers:**
- "load my restoration prompt"
- "restore from restoration prompt"
- "apply my restoration prompt"
- "use my restoration prompt"  
- "load session restoration prompt"

**Process:**
1. Check for prompt file: `restore-prompts/<session-id>.md`
2. Check enabled/disabled state
3. If prompt exists and enabled:
   - Read the file
   - Apply the context
   - Respond: "‚úÖ Restoration prompt loaded for [project/channel]. Context restored: [key points]. Ready to continue. What would you like to work on?"

4. If prompt exists but disabled:
   - Ask: "Restoration prompt is currently disabled for this session. Would you like me to load it anyway (one-time)?"
   - If user confirms: Load despite disabled state
   - If user declines: Skip loading

5. If prompt doesn't exist:
   - Respond: "No restoration prompt found for this session. Would you like to create one? I can help you set up a restoration prompt. Run: tide-watch restore-prompt edit --session <session-id>"

**Manual loading works:**
- At any time (not just session start)
- Mid-session (refresh context)
- Even when auto-load is disabled
- Can override disabled state (with confirmation)

**Feature discovery and guided creation:**

**When to offer creation:**
- ‚úÖ Right after session reset (first few messages) AND no prompt exists
- ‚úÖ User manually re-explains project context (signals need for persistence)
- ‚úÖ During capacity warnings (90%+) to prepare for potential reset
- ‚ùå User just declined (same session)
- ‚ùå Session is < 10 messages old (too early to know if needed)
- ‚ùå More than once per session (avoid nagging)

**Discovery message (brief, non-intrusive):**
"üí° Tip: You can create a restoration prompt to help me remember project context after resets. Interested?"

**If user agrees, guide step-by-step:**

1. "Great! Let's create a restoration prompt. I'll ask a few quick questions. You can skip any by saying 'skip'."

2. Ask:
   - "What project or topic is this session for? (e.g., 'Web app development', 'Research project', 'Writing tasks')"
   - "Where are the important files? (e.g., '~/projects/myapp/', '~/Documents/research/')"
   - "What's your current focus? (e.g., 'API integration', 'Chapter 3', 'Bug fixes')"
   - "Any important workflow rules? (e.g., 'Always test before committing', 'Use specific format')"
   - "Any constraints or things NOT to do? (e.g., 'Don't modify config files', 'Preserve existing structure')"

3. Generate prompt content from answers:
   - Pre-fill template with user's responses
   - Include current conversation context (project mentions, paths)
   - Add session metadata (channel, label)

4. Save and confirm:
   "‚úÖ Restoration prompt created! Saved to: restore-prompts/<session-id>.md
   
   Next time this session resets, I'll automatically load this context.
   
   You can edit anytime: tide-watch restore-prompt edit --session <id>"

**If user declines:**
- Don't ask again this session
- Don't make them feel bad
- Mention it again on next reset (but not this session)

**Pre-fill from context:**
If user agrees to create prompt, extract from current conversation:
- Project name (from user messages)
- File paths mentioned
- Workflow details discussed
- Any explicit constraints given

This makes creation easier - user just confirms/edits rather than writing from scratch.

**During capacity warnings (optional reminder):**

At 90%+ capacity, include brief reminder:
"üí° Create a restoration prompt for quick recovery after reset: tide-watch restore-prompt edit --session <id>"

Don't make it the focus - just a helpful aside in the warning message.

**Skill**: [Tide Watch](https://github.com/chrisagiddings/openclaw-tide-watch) üåä
